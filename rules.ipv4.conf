# Generated by iptables-save v1.4.21 on Sun Oct 18 19:59:33 2020
# Punto a. Se utiliza netfilter-persistent como método de carga del fiwerall al inicio. #
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A POSTROUTING -d 0.0.0.0/0 -j MASQUERADE
COMMIT

*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# Punto b. Drop everything that hasn't been picked up by one of the following rules. #
-P INPUT DROP
-P FORWARD DROP
-P OUTPUT DROP

# Punto c. Allow internal loopback connections #
-A INPUT -i lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT

# Allow pinging
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT

# =========BEGIN SERVER SPECIFIC PORT OPEN RULES========= #

# Punto d. Permitir Administración Firewall via SSH al cliente-02 #
-A INPUT -p tcp -s 192.168.20.2 -d 192.168.20.1 --dport 22 -m state --state NEW,ESTABLISHED -i eth2 -j ACCEPT
-A OUTPUT -p tcp -s 192.168.20.1 -d 192.168.20.2 --sport 22 -m state --state ESTABLISHED -j ACCEPT

# Permitir Administración Firewall via SSH PC física #
#-A INPUT -p tcp -s 192.168.0.4 -d 192.168.0.8 --dport 22 -m state --state NEW,ESTABLISHED -i eth0 -j ACCEPT
#-A OUTPUT -p tcp -s 192.168.0.8 -d 192.168.0.4 --sport 22 -m state --state ESTABLISHED -j ACCEPT

# Punto e. Permitir Acceso a HTTP al cliente-03 #
#-A FORWARD -s 192.168.20.3 -i eth2 -o eth0 -p tcp -m multiport --sport 80,443,8080 -j ACCEPT
#-A FORWARD -d 192.168.20.3 -i eth0 -o eth2 -p tcp -m multiport --sport 80,443,8080 -j ACCEPT
-A FORWARD -s 192.168.20.3 -i eth2 -o eth0 -p tcp -j ACCEPT
-A FORWARD -d 192.168.20.3 -i eth0 -o eth2 -p tcp -j ACCEPT

# Punto f. Permitir a cliente 04 el acceso al webserver #
#-A FORWARD -s 192.168.20.4 -d 192.168.10.3 -i eth2 -o eth1 -p tcp -m multiport --dport 80,443,8080,8443 -j ACCEPT
#-A FORWARD -s 192.168.10.3 -d 192.168.20.4 -i eth1 -o eth2 -p tcp -m multiport --dport 80,443,8080,8443 -j ACCEPT
-A FORWARD -s 192.168.20.4 -d 192.168.10.3 -i eth2 -o eth1 -j ACCEPT
-A FORWARD -s 192.168.10.3 -d 192.168.20.4 -i eth1 -o eth2 -j ACCEPT

# Permitir el acceso del fileserver al cliente-03 #

-A INPUT -p all -s 192.168.20.253 -d 192.168.20.3 -m state --state NEW,ESTABLISHED -j ACCEPT
-A OUTPUT -p all -s 192.168.20.3 -d 192.168.20.253 -m state --state ESTABLISHED -j ACCEPT


# =========END SERVER SPECIFIC PORT OPEN RULES========= #
# Desabilitado para el trabajo práctico. #
# Allow any outbound data, and any inbound data related to a connection that is already in use #
#-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT #
#-A OUTPUT -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT #
COMMIT
# Completed on Sun Oct 18 19:59:33 2020
